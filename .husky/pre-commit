#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîç Running ESLint on staged files..."

# Get only staged JavaScript/TypeScript files
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|ts|jsx|tsx)$' || true)

if [ -z "$STAGED_FILES" ]; then
  echo "‚úÖ No JavaScript/TypeScript files to lint. Skipping ESLint check."
  exit 0
fi

# Run ESLint only on staged files and attempt fixes
npx eslint --fix $STAGED_FILES || { echo "‚ùå Fix ESLint errors before committing!"; exit 1; }

# Ensure only modified files are staged again
git update-index --refresh

echo "‚úÖ ESLint check passed!"
exit 0
